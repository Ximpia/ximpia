<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

{% load i18n %}

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!--<link rel="shortcut icon" href="{{p.lnk_d.S3}}/images/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="{{p.lnk_d.S3}}/images/favicon.png">
<link rel="apple-touch-icon" href="{{p.lnk_d.S3}}/images/favicon.png" type="image/png" />

<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://blog.buscaplus.com/feed/"  />
<link rel="alternate" type="text/xml" title="RSS .92" href="http://blog.buscaplus.com/feed/rss/"  />
<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://blog.buscaplus.com/feed/atom/" />-->

<title>{% block title %}{% endblock %}</title>

<link href="/site_media/css/main.css" rel="stylesheet" type="text/css" />
{% block css %}
{% endblock %}

</head>

<body>

{% block form %}<form id="Form1" action="">{% endblock %}
{% csrf_token %}

<table width="100%" cellspacing="0" cellpadding="0"><tr><td align="center" >

<div id="Wrapper" >

    <div id="Header" >
    
    <div id="Logo">
    {% if request.user.is_authenticated %}
    <img id="LogoImg" src="/site_media/images/blank.png" /> <br/>
	<img id="BetaImg" src="/site_media/images/blank.png" />
	{% else %}
	<a href="/"><img id="LogoImg" src="/site_media/images/blank.png" /> <br/>
	<img id="BetaImg" src="/site_media/images/blank.png" /></a>
	{% endif %}
    
    </div>
    
    <div id="IconMenu">
    	{% if request.user.is_authenticated %}

        <!--<img src="/site_media/images/home_60.png" title="Home" />
        <img src="/site_media/images/users_two_60.png" title="Contacts" />
        <img src="/site_media/images/globe_60.png" title="Links" />
        <img src="/site_media/images/folder_full_60.png" title="Files" />
        <img src="/site_media/images/lightbulb_60.png" title="Help" />
        <img src="/site_media/images/spanner_60.png" title="Settings" />
        <img src="/site_media/images/logout_60.png" title="Logout" />-->
		
		<img src="/site_media/images/add_60.png" title="Signup" />
		<img src="/site_media/images/users_two_60.png" title="Friends" />
		<img src="/site_media/images/paper_content_60.png" title="About Us" />
		<img src="/site_media/images/mail_add_60.png" title="Contact Us" />
		<img src="/site_media/images/lock_60.png" title="Privacy" />
        <img src="/site_media/images/go_60.png" title="Login" />
		
		{% else %}
		
        <!--<a href="/"><img src="/site_media/images/home_60.png" title="Home" /></a>-->
		<img src="/site_media/images/add_60.png" title="Signup" />
		<img src="/site_media/images/users_two_60.png" title="Friends" />
		<img src="/site_media/images/paper_content_60.png" title="About Us" />
		<img src="/site_media/images/mail_add_60.png" title="Contact Us" />
		<img src="/site_media/images/lock_60.png" title="Privacy" />
        <img src="/site_media/images/go_60.png" title="Login" />
		
		{% endif %}
    </div>
    
    </div>
    <!-- End Header -->
    
	{% if bar %}
    <div id="HeaderBar" style="margin-top:2px;">    
    <table style="border:0px solid; position:relative; left: -128px" width="100%">
    <tr>
    <td>
        <!-- Icons Here -->
    </td>
    <td style="text-align:right">
    <input type="text" class="InputTextSmall ShortcutStart" name="" id="" value="What do you want to do?" style="width:200px" />
    </td>
    </tr>
    </table>
    </div>
    <!-- End HeaderBar -->
	{% endif %}
    
    <div id="Apps" style="border:solid 1px #ddd; margin-top:10px" >
    
	{% block app %}
	{% endblock %} 
    
    </div>
    <!-- End Apps -->
    
    <br class="clearfloat"/>

    <div id="Footer">
        <div id="FooterText">
        <table width="100%"><tr><td style="width: 100px">
        &copy; 2011 &nbsp;<a href="http://www.tecor.com"><img id="TecorLogo" src="http://ximpia-test.s3.amazonaws.com/images/blank.gif" alt="Tecor Communications S.L." title="Tecor Communications S.L." /></a>
        </td><td>
        <!--<a href="/es/quienesSomos.html">Quienes Somos</a> | <a href="/es/apoyos.html">Nuestros Apoyos</a> | <a href="/robi/">Robi, El Robot</a> | <a href="/es/contacto.html">Contacta</a> | 
        <a href="/es/contract/privacy.html">Privacidad</a> | --><a href="http://twitter.com/ximpia" target="site">@ximpia</a>
        </td></tr></table>
        </div>
    </div>
    
</div>

<br/>

</td></tr></table>

<!-- START POPUP MESSAGE -->
<div class="Pops">
<div id="PopMessage" class="PopMessage">
<div id="PopMsgWrapper">
<div class="MsgTitle"></div>
<div class="MsgText"></div>
<div class="MsgButtons"></div>
</div>
<br class="clearfloat" />
</div>
<!--[if lte IE 6.5]><iframe></iframe><![endif]-->
</div>
<!-- END POPUP MESSAGE -->

<p id="Variables">
	
	<input type="hidden" id="msgError_GEN_VALIDATION" name="msgError_GEN_VALIDATION" value="{% trans "Error validating your data. Check errors marked in red" %}" />
	<input type="hidden" id="id_siteMedia" name="siteMedia" value="{{settings.MEDIA_URL}}" />
	<input type="hidden" id="id_buttonConstants" name="buttonConstants" value="[['close','{% trans "Close" %}']]" />
	
	<input type="hidden" id="id_facebookAppId" name="facebookAppId" value="{{settings.FACEBOOK_APP_ID}}" />	

{% block hidden %}

{% for field in form %}
    {% if field.is_hidden %}
    {{field}}
	{% endif %}
{% endfor %}

{% endblock %}

</p>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>

<script type="text/javascript" src="/site_media/js/jquery-plugins/jquery.jqDock.min.js"></script>

{% block js %}
{% endblock %}

<script language="JavaScript">
	
jQuery(document).ready(function($){

  // set up the options to be used for jqDock...  
    var labelTransform = function(labelText, optionIndex){ //scope (this) is the #menu element
		rtn = "<div class='jqDockLabelNew' style='position: relative'>" + labelText + "</div>";
        return rtn;
      },
  dockOptions = { align: 'top' // horizontal menu, with expansion DOWN from a fixed TOP edge
    , labels: true  // add labels (defaults to 'br')
    , size: 45
	,setLabel: labelTransform
    };
  // ...and apply...
  $('#IconMenu').jqDock(dockOptions);
  
  $('#IconMenu img').click(function() {
  	// Do click on Icons here...
	// Animation of button, fade panel, big loading icon
	// Show page in div
  });
  
  function getValue(id, key) {
  	var array = eval($("#" + id).attr('value'));
	var value = '';
	for (var i=0; i<array.length; i++) {
		var list = array[i];
		if (list[0] == key) {
			value = list[1];
		}
	}
	return value;
  }
  function hasKey(id, key) {
  	
  }

	function doShowPasswordStrength(userId, passwordId, submitId) {
		// Password Strength
		$("#" + passwordId).passStrengthener({
					userid:	"#" + userId,
					strengthCallback:function(score, strength)
						{						
							if(strength == 'good' || strength == 'strong')
							{
								$("#" + submitId).removeAttr('disabled');
							}
							else
							{
								$("#" + submitId).attr('disabled', 'disabled')
							}
						}
				});			
	}
		
	function doBindSubmitForm(formId, callbackFunction) {
		$(".submit").click(function() {
			var isValid = $("#" + formId).valid();
			var idImg = 'id_' + formId + '_Submit_Status';
			var idTxt = 'id_' + formId + '_Submit_Text';
			if (isValid == true) {
				// OK
				$("#" + formId).submit();
			} else {
				// Format errors
				$("#" + idImg).addClass('AjaxButtonERROR');
				$("#" + idTxt).text($("#msgError_GEN_VALIDATION").attr('value'));
			}
		});
		$("#" + formId).validate({
			submitHandler: function(form) {
				// Submit form
				var idImg = 'id_' + form.id + '_Submit_Status';
				var idTxt = 'id_' + form.id + '_Submit_Text';				
				$("#" + idImg).xpLoadingSmallIcon();
				$("#" + idImg).xpLoadingSmallIcon('wait');
				$("#" + idTxt).text('');
				$(form).ajaxSubmit({
					dataType: 'json',
					success: function(response, status) {
						var responseMap = eval(response);
						statusCode = responseMap['status'];
						if (statusCode == 'OK') {
							$("#" + idImg).xpLoadingSmallIcon('ok');
							$("#" + idTxt).text($("#id_msg_ok").attr('value'));
							// Put all fields inside form valid that are now errors
							$(".error").addClass('valid').removeClass("error");
							// Disable button
							$("#id_" + form.id + '_Submit').attr('disabled', 'disabled')
							if ($("#" + 'id_msgSubmit_Form1').attr('value')) {
								showPopUp('id_msgSubmit_Form1');
							} else {
								callbackFunction();
							}						
						} else {
							$("#" + idImg).xpLoadingSmallIcon('error');
							$("#" + idTxt).text($("#msgError_GEN_VALIDATION").attr('value'));
							// Integrate showMessage, popUp, etc...
							var list = responseMap['errors'];
							message = '<ul>'
							for (var i=0; i<list.length; i++) {
								var errorId = list[i][0];
								var errorMessage = list[i][1];
								//alert(errorId);
								$("#" + errorId).removeClass("valid");
								$("#" + errorId).addClass("error");
								message = message + '<li>' + errorMessage + '</li>';
							}
							message = message + '</ul>';
							// Show error Message in pop up
							showPopUp({
								title: 'Errors Found',
								message: message,
							});
						}
					},
					error: function (data, status, e) {
						$("#" + idImg).xpLoadingSmallIcon('errorWithPopUp');
						showPopUp({
							title: 'System Error',
							message: 'I cannot process your request due to an unexpected error. Sorry for the inconvenience, please retry later. Thanks',
							height: 50
						});
					}
				});
 			},
			errorPlacement: function(error, element) {
				element.next("img table").after(error);
   			}
		});			
	}
	
	function showRemoteError() {
		showPopUp('MessageERROR');
	}
		
	//function showMessage(sTitle, sMessage, sButtons, sEffectIn, sEffectOut, bFadeBackground, iWidth, iHeight, functionShow) {
	function showMessage(messageOptions) {
		var sTitle = '';
		var sMessage = '';
		var sButtons = 'MsgCPClose:' + eval($("#id_buttonConstants").attr('value'))['close'];
		var sEffectIn = 'fadeIn,1000';
		var sEffectOut = '';
		var bFadeBackground = true;
		var iWidth = null;
		var iHeight = null;
		functionShow = null;
		if (messageOptions.title) sTitle = messageOptions.title;
		if (messageOptions.message) sMessage = messageOptions.message;
		if (messageOptions.buttons) sButtons = messageOptions.buttons;
		if (messageOptions.effectIn) sEffectIn = messageOptions.effectIn;
		if (messageOptions.effectOut) sEffectOut = messageOptions.effectOut;
		if (messageOptions.fadeBackground) bFadeBackground = messageOptions.fadeBackground;
		if (messageOptions.width) iWidth = messageOptions.width;
		if (messageOptions.height) iHeight = messageOptions.height;
		if (messageOptions.functionShow) functionShow = messageOptions.functionShow;
		bFadeOut = checkFadeOut();
		if (!bFadeOut) {
			bFadeBackground = false;
		}
		iScreenWidth = document.body.clientWidth;
		if (iWidth) {
			$("div.PopMessage").css('width', iWidth + 'px');
			$("div#PopMsgWrapper").css('width', iWidth + 'px');
		}
		else {
			$("div.PopMessage").css('width', '450px');
			$("div#PopMsgWrapper").css('width', '450px');
		}
		if (iHeight) {
			$("div.MsgText").css('height', iHeight + 'px');
			var iTopPosition = 80;
		}
		iLeft = (iScreenWidth/2)- parseInt($("div.PopMessage").css('width'))/2;
		if (!$.browser.msie) {
			iTopOffset = window.pageYOffset;
		}
		else {
			iTopOffset = document.documentElement.scrollTop;
		}
		//alert(sMessage.length);
		if (!iHeight) {
			if (sMessage.length <= 100) {
				//var iTopPosition = 160;
				var iTopPosition = 130;
				$("div.MsgText").css('height', '40px');
				$("div.MsgText").css('overflow', 'hidden');
			}
			else if (sMessage.length <= 250 && sMessage.length > 100) {
				//var iTopPosition = 160;
				var iTopPosition = 130;
				$("div.MsgText").css('height', '150px');
				$("div.MsgText").css('overflow', 'hidden');
			}
			else {
				var iTopPosition = 80;
				$("div.MsgText").css('height', '200px');
				$("div.MsgText").css('overflow', 'auto');
			}
		}
		iTop = iTopPosition + iTopOffset;
		$("div.MsgTitle").text(sTitle);
		$("div.MsgText").html(sMessage);
		//$("#PopMsgWrapper .MsgText").html(sMessage);
		ButtonList = sButtons.split(',');
		$("div.MsgButtons").text('');
		for (var i=0; i<ButtonList.length; i++) {
			Fields = ButtonList[i].split(':');
			sButtonId = Fields[0];
			sButtonText = Fields[1];
			$("div.MsgButtons").append('<input type="button" id="' + sButtonId + '" value="' + sButtonText + '" class="Button"/>');
		}
		EffectInList = sEffectIn.split(',');
		sEffectInTxt = EffectInList[0];
		iEffectInTime = parseInt(EffectInList[1]);
		EffectOutList = sEffectOut.split(',');
		sEffectOutTxt = EffectOutList[0];
		iEffectOutTime = parseInt(EffectOutList[1]);
		if (sEffectInTxt == 'fadeIn') {
			$("div.PopMessage").fadeIn(iEffectInTime);
		}	
		$("div.Pops").css('left', iLeft + 'px');
		$("div.Pops").css('top', iTop + 'px');
		$("div.Pops").css('visibility','visible');
		if (sEffectOutTxt == 'fadeOut') {
			$("div.PopMessage").fadeOut(iEffectOutTime);
		}
		if (bFadeBackground) {
			$("#Wrapper").fadeTo("fast", 0.60);
		}
		if (functionShow) {
			functionShow($(this));
		}
	}

	function clickMsgOk(bFadeBackground, functionName) {
		bFadeOut = checkFadeOut();
		if (!bFadeOut) {
			bFadeBackground = false;
		}
		$(".Pops").css('left','-2000px');
		if (bFadeBackground) {
			$("#Wrapper").fadeTo("fast", 1.0);
		}
		if (functionName) {
			functionName();
		}
	}

	// Pop Up Message. It is used for Ajax actions, like OK Message, Error messages, etc...
	function showPopUp(key) {
		if (typeof key == 'string') {
			var sId = key;
			var messageOptions = new Object();
		}
		else {
			var messageOptions = key;
			var sId = '';
		}
		var sFadeOut = '';
		var sUrl = '';
		var sTitle = '';
		var sMessage = '';
		var iHeight = null;
		functionName = null;
		if (sId.length != 0) {
			var popUpData = eval($("#" + sId).attr('value'));
			sTitle = popUpData[0];
			message = popUpData[1].replace(/[:]{2}[p][:]{2}/g,'</p>');
			message = message.replace(/[:][p][:]/g,'<p>');
			sMessage = '<table><tr><td style="vertical-align:top"><img class="' + popUpData[2] + '" src="' + $("#id_siteMedia").attr('value') 
			+ 'images/blank.png" /></td><td style="vertical-align:top">' + message + '</td></tr></table>'
		} else {
			sFadeOut = messageOptions.fadeout;
			bFadeOut = messageOptions.fadeBackground;
			sUrl = messageOptions.url;
			sTitle = messageOptions.title;
			sMessage = messageOptions.message;
			iHeight = messageOptions.height;
			functionName = messageOptions.functionName;			
		}
		if (!sFadeOut){
			sFadeOut = ''
			bFadeOut = true;
		}
		else {
			if (sFadeOut == '') {
				bFadeOut = true;
			}
			else {
				bFadeOut = false;
			}
		}
		bIE = checkIE();
		if (bIE) {
			bFadeOut = false;
		}
		// This is to prevent fadeouts in popups since Internet Explorer does not show frame border
		sFadeOut = '';
		var closeValue = getValue('id_buttonConstants', 'close');
		showMessage({
			title: sTitle,
			message: sMessage,
			buttons: 'MsgOk:' + closeValue,
			effectIn: 'fadeIn,1000',
			effectOut: sFadeOut,
			fadeBackground: bFadeOut
		});
		//showMessage(sTitle, sMessage, 'MsgOk:OK', 'fadeIn,1000', sFadeOut, bFadeOut);
		if (sFadeOut == '') {
			$("#MsgOk").click(function() {clickMsgOk(bFadeOut, functionName)});
		}
		if (sUrl) {
			if (sUrl != '') {
				$("#MsgOk").click(function() {
					window.location = sUrl;
				});
			}
		}
   }
   
	function checkFadeOut() {
		if (jQuery.browser.msie) {
			bCheck = false;
		}
		else {
			bCheck = true;
		}
		return bCheck
	}
	
	function checkIE6() {
		if (jQuery.browser.msie && jQuery.browser.version.substr(0,3)=='6.0') {
			bIE6 = true;
		}
		else {
			bIE6 = false;
		}
		return bIE6;
	}

	function checkIE() {
		if (jQuery.browser.msie) {
			bIE = true;
		}
		else {
			bIE = false;
		}
		return bIE
	}
	
	function doReloadCaptcha() {
		$("#id_ImgRefreshCaptcha").click(function() {
			// reload captcha
			$.get('/reloadCaptcha');
			// Show image
			var kk = Math.random();
			$("#id_ImgCaptcha").attr('src', '/captcha/captcha.png?code=' + kk);
		});
	}
	
	function doBindBubbles() {
		var bubbleOptions = {position : 'right',
						align	 : 'center',
						innerHtmlStyle: {color:'black', 'text-align':'center', 'font-size': '10pt'},
						themeName: 	'blue',
						themePath: 	'/site_media/images/jquerybubblepopup-theme'
		};
		$('.ImgInfo').CreateBubblePopup(bubbleOptions);
		$('.ImgInfo').mouseover(function() {
			var fieldList = $(this).attr('id').split('id_img_');
			var textId = 'id_msg_' + fieldList[1];
			var bubleText = $('#' + textId).attr('value');
			$(this).SetBubblePopupInnerHtml(bubleText, true);
		});
		/*$('input.Small').focus(function() {
			var name = $(this).attr('name');
        	var textId = 'id_msg_' + name;
        	var bubleText = $('#' + textId).attr('value');
			$('#' + 'id_img_' + name).SetBubblePopupInnerHtml(bubleText, true);
			$('#' + 'id_img_' + name).ShowBubblePopup();
		});
		$('input.Small').blur(function() {
			var name = $(this).attr('name');
        	$('#' + 'id_img_' + name).HideBubblePopup();
    	});*/		
	}
	
	///////////////////////////////////////////////////////////////////////
	// Validation
	//jQuery.validator.messages.required = "";
	// Ximpia Generic Validations
	jQuery.validator.addMethod("ximpiaid", function(value, element) {
		return this.optional(element) || /^[a-zA-Z0-9_.]+$/i.test(value);
	}, "mensaje");
	jQuery.validator.addMethod("password", function(value, element) {
		return this.optional(element) || /^[a-zA-Z0-9$#!&%]+$/i.test(value);
	}, "mensaje");


    // ***********************************************************************
	//     VISUAL COMPONENTS DATA
	// **********************************************************************

    // SocialNetworkIconData visual component data methods	
    function SocialNetworkIconData(id) {
		this.id = id;
		var inputData = $("#" + this.id).attr('value');
		this.dataDictList = JSON.parse(inputData);
		this.getDataDictList = function() {
			return this.dataDictList
		}
        this.getData = function() {
			return this.dataDictList[1]
        }
        this.getConfig = function() {
            return this.dataDictList[0]
        }
        this.getToken = function() {
			return this.dataDictList[1].token
        }
        this.setToken = function(token) {
			this.dataDictList[1].token = token;
			$("#" + this.id).attr('value',JSON.stringify(dataDictList))
        }
    }
	
	// GenericComponentData
    function GenericComponentData(id) {
        this.id = id;
        var inputData = $("#" + this.id).attr('value');
        this.dataDictList = JSON.parse(inputData);
        this.getDataDictList = function() {
            return this.dataDictList
        }
        this.getDataList = function() {
            return this.dataDictList[1].data;
        }
		this.getDataListPaging = function(page, numberPages) {
			var size = this.getSize();
			// TODO
		}
        this.setDataList = function(array) {
			this.dataDictList[1].data = array;
        }
        this.addDataEnd = function(obj) {
			var size = this.dataDictList[1].data.push(obj);
			$("#" + this.id).attr('value', JSON.stringify(this.dataDictList));
        }
        this.writeData = function(obj, i) {
            this.dataDictList[1].data[i] = obj;
			$("#" + this.id).attr('value', JSON.stringify(this.dataDictList));
        }
		this.getSize = function() {
			return this.dataDictList[1].data.length;
		}
		this.hasElement = function(searchText) {
			var array = this.getDataList();
			var hasElement = false;
			for (var i = 0; i< array.length; i++) {
				if (array[i].text == searchText) {
					hasElement = true;
				}
			}
			return hasElement;
		}
		this.hasElementByName = function(searchText) {
			var array = this.getDataList();
			var hasElement = false;
			for (var i = 0; i< array.length; i++) {
				if (array[i].name == searchText) {
					hasElement = true;
				}
			}
			return hasElement;
		}
        this.deleteData = function(i) {
			var newArray = new Array();
			var array = this.getDataList();
			for (var j=0; j<array.length; j++) {
				if (i != j) {
					newArray.push(array[j]);
				}
			}
			this.setDataList(newArray);
			$("#" + this.id).attr('value', JSON.stringify(this.dataDictList));
        }
        this.getConfigDict = function() {
            return this.dataDictList[0];
        }
    }


<!--{% block jquery %}-->
<!--{% endblock %}--> 

});

</script>

</form>

{% block forms %}
{% endblock %}

</body>
</html>
