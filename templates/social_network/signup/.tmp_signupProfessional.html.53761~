{% extends "base/base.html" %}

{% load i18n %}
{% load networks %}

{% block form %}<form id="Form1" action="" method="post">{% endblock %}

{% block js %}

<script type="text/javascript" src="{{settings.MEDIA_URL}}js/jquery-plugins/jquery.passStrengthener.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/jquery-plugins/jquery.bubblepopup.v2.3.1.min.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/jquery-plugins/jquery.metadata.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/jquery-plugins/jquery.form.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/jquery-plugins/jquery.validate.js"></script>

<!--<script type="text/javascript" src="{{settings.MEDIA_URL}}js/json.js"></script>-->

<script type="text/javascript" src="http://connect.facebook.net/en_US/all.js"></script>

<!--<script type="text/javascript" src="http://platform.linkedin.com/in.js">
  api_key: UqqNxkAHjuhRzW4PMdyq2H-_MqWyFTDmTtTOfa6TiIX_Nu73_f7YdWNtI__yUnl5
  onLoad: onLinkedInLoad
  authorize: true
</script>-->

<!--
<script type="text/javascript">  
  // 2. Runs when the JavaScript framework is loaded
  function onLinkedInLoad() {
    IN.Event.on(IN, "auth", onLinkedInAuth);
  }

  // 2. Runs when the viewer has authenticated
  function onLinkedInAuth() {
    IN.API.Profile("me").result(displayProfiles);
  }

  // 2. Runs when the Profile() API call returns successfully
  function displayProfiles(profiles) {
    member = profiles.values[0];
    //document.getElementById("profiles").innerHTML = 
    //  "<p id=\"" + member.id + "\">Hello " +  member.firstName + " " + member.lastName + "</p>";
  }
</script>
-->

<!-- Facebook Button -->
<div id="fb-root"></div>
<!-- Facebook Button -->

{% endblock %}

{% block jquery %}

	var formId = "Form1";
	doShowPasswordStrength('id_ximpiaId', 'id_password', 'id_' + formId + '_Submit');
	doBindBubbles();
		
	// Form1
	doBindSubmitForm(formId);
	
    // reloadCaptcha
    doReloadCaptcha();
	
	// Social Network Icons
	$(".Icon").mouseover(function() {
		$(this).fadeTo("fast", 0.70);
	});
	$(".Icon").mouseout(function() {
		$(this).fadeTo("fast", 1.00);
	});
	
	function processSnLogin() {	
		// Click on Facebook or LinkedIn button
		$(".SnLogin").click(function() {
			var sId = $(this).attr('id');
			if (sId == 'id_facebookLogin') {
				// Facebook
				FB.login(function(response) {
	  				if (response.session) {
						$("#id_facebookToken").attr('value', response.session.access_token);
						//alert(response.session.access_token);
    					if (response.perms) {
	      					// user is logged in and granted some permissions.
      						// perms is a comma separated list of granted permissions
							$("#id_fbLoginButton").css('display', 'block');
							$("#id_mixLoginButton").css('display', 'none');
							FB.XFBML.parse();
							// Hide passwords
							$("#id_showPassword").css('display','none');
							// Get profile
							FB.api('/me', function(responseProfile) {
								// Fillout fields in form
								$("#id_firstName").attr('value', responseProfile.first_name);
								$("#id_lastName").attr('value', responseProfile.last_name);
								$("#id_email").attr('value', responseProfile.email);
								$("#id_ximpiaId").attr('value', responseProfile.ximpiaId);
								var locationName = responseProfile.location.name;
								var locationFields = locationName.split(',');
								$("#id_city").attr('value', locationFields[0].trim());
								var locale = responseProfile.locale;
								$("#id_country").attr('value', locale.split('_')[1].toLowerCase());
								// Update facebook Icon : Cannot click and checked
								$("#id_facebookIcon").addClass('SocialNetworkIconUsed');
								$("#id_facebookIcon").removeClass('SocialNetworkIcon');
								$("#id_facebookCheck").css('visibility','visible');
								$("#id_facebookIcon").unbind();
							});
    					} else {
	      					// user is logged in, but did not grant any permissions
							// Fillout fields in form
    					}
  					} else {
	    				// user is not logged in
  					}
				}, {perms:'email,user_birthday'});
			}
			else if (sId == 'id_linkedInLogin') {
				// LinkedIn
				//IN.UI.Authorize().place();
				alert('LinkedIn');
			}
		});
	}

	var fbAppId = $("#id_facebookAppId").attr('value');
	FB.init({appId: fbAppId, status: true, cookie: true, xfbml: true});
  	//FB.Event.subscribe('auth.sessionChange', function(response) {
    //	if (response.session) {
    //		// A user has logged in, and a new cookie has been saved
	//		alert('In....');
    //	} else {
    //		// The user has logged out, and the cookie has been cleared
	//		alert('Out....');
    //	}
	//});

	processSnLogin();
		
{% endblock %}

{% block title %}Ximpia - {% trans "Signup" %}{% endblock %}

{% block app %}

    <div id="app_Site" style="width: 100%; border: 0px solid" >
	
	<table id="SearchPadding"><tr><td style="width: 700px; padding-left: 30px;">
	
	{% if show_message %}
	<div id="ErrorMessage" style="background-color:#DDDDDD; padding:20px"><b>Message</b></div>
	{% endif %}

	<h3>XimpiaId</h3>
	
	You can authenticate with password or sign up with Facebook or LinkedIn. In the last case you will not need to validate your email.<br/><br />
	
	<table cellspacing="0" cellpadding="0"><tr><td style="vertical-align:top;">
	<div class="FormBlock">
    <label for="id_ximpiaId">XimpiaId: {{form.ximpiaId}} <br />
	<div id="id_showPassword">
	{% if not loginFB %}
	<label for="id_password">{% trans "Password" %}: {{form.password}} <br/>
	<label for="id_passwordVerify">{% trans "Password Verify" %}: {{form.passwordVerify}} <br />
	{% endif %}
	</div>
	</div>
	</td>

    <td style="width: 50px"></td>
	<td style="background-color:#000000; width: 1px"> <img src="{{settings.MEDIA_URL}}images/blank.png" /></td>
	<td style="width: 50px"></td>	
	<td style="vertical-align:top;">
	
	<div id="id_socialNetworkSignupButtonsZone">
		
	{% if loginSN %}
	
	   {% if loginFB %}
	   
		<div id="id_fbLoginButton">
			<fb:login-button perms="email,user_birthday" show_faces="true"></fb:login-button>
		</div>
	   
	   {% else %}
	   
	   <!-- LinkedIn Login Code -->
	   
	   {% endif %}
	
	{% else %}
	
	<div id="id_fbLoginButton" style=" display:none;">
		<fb:login-button perms="email,user_birthday" show_faces="true"></fb:login-button>
	</div>
	
	<div id="id_mixLoginButton">
		
    	<img id="id_facebookLogin" src="{{settings.MEDIA_URL}}images/signin_with_facebook.png" class="SnLogin" />
    
    	<br/><br/>
    	<!--<img id="id_linkedInLogin" src="{{settings.MEDIA_URL}}images/signin_with_linkedin.png" class="SnLogin Icon" />-->
		
		<table border="0">
			<tr>
				<td><img id="id_linkedInLogin" src="{{settings.MEDIA_URL}}images/signin_with_linkedin.png" class="SnLogin" /></td>
				<td><img id="id_linkedInLoginCheck" src="{{settings.MEDIA_URL}}images/check.png" class="SocialNetworkIconsCheck" /></td>
			</tr>
		</table>		
		
	</div>
	
	{% endif %}	
	
	</div>	
		
	</td>
	
	</tr></table>	

	<div id="UserData">	
	
	<h3>{% trans "About You" %}</h3>
	
	<div id="Info" class="FormBlock">
	<table border="0"><tr><td style="vertical-align: top">
	<label for="id_firstName">{% trans "First Name" %}: {{form.firstName}}<br />
	<label for="id_lastName">{% trans "Last Name" %}: {{form.lastName}}<br />
	<label for="id_email">Email: {{form.email}}<br />
	<label for="id_city">{% trans "City" %}: {{form.city}}<br />
	<label for="id_country">{% trans "Country" %}: {{form.country}}<br />	
	</td>
	<td style="vertical-align: top; padding-left: 50px">
	<label for="id_industry">{% trans "Industry" %}: {{form.industry}}<br />	
	</td>
	</tr></table>
	
	</div>
	
	</div>	
	
    <h3>{% trans "Your Networks" %}</h3>
    <div id="SocialNetworks" class="FormBlock">
    	You can also link your account to your other networks.
	<table>
		<tr>
			
          <td style="width:85px">
          	
			<!-- Data associated to this icon: id_facebookIcon_data in JSON format: status -->
			<!--<img id="id_facebookIcon" src="{{settings.MEDIA_URL}}images/blank.png" class="Icon FacebookIcon AuthIcon" />-->
			<!-- <img id="id_facebookStatus" src="{{settings.MEDIA_URL}}images/blank.png" class="IconStatusOK" style="visibility:visible;" /> -->

			{% socialNetworkIcon "facebook" %}
			
          </td>
		  
          <td style="width:85px">
			
			{% socialNetworkIcon "linkedIn" %}
			
          </td>
          		  
		  <td style="width:85px">
		  	
			{% socialNetworkIcon "twitter" %}

		  </td>
		  
          <td>
          </td>
		  
		</tr>
	</table>
	
    </div>
		
	{% if showInvitation %}
	<h3>{% trans "Invitation" %}</h3>
	<div id="Invitation" class="FormBlock">
		<label for="id_invitationCode">{% trans "Invitation Code" %}: {{form.invitationCode}}
	</div>
	{% endif %}
	
	{% if not showInvitation %}
	<h3>{% trans "Validation" %}</h3>
	{% include "plugins/captcha.html" %}
	{% endif %}	
	
	<br />
	{% include "plugins/submitBar.html" %}	
	<br /><br />
	
	</td>
		
	</tr>
	</table>
	
    
    </div>
    <!-- End app_MyApp -->

{% endblock %}
